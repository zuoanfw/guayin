<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>注册-{$tpshop_config['shop_info_store_title']}</title>
    <meta name="keywords" content="{$tpshop_config['shop_info_store_keyword']}" />
    <meta name="description" content="{$tpshop_config['shop_info_store_desc']}" />

    <link rel="stylesheet" type="text/css" href="__PUBLIC__/bootstrap/css/bootstrap.css"/>
    <link href="__STATIC__/css/register.css" rel="stylesheet" />
    <script type="text/javascript" src="__PUBLIC__/js/jquery-1.10.2.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/bootstrap/js/bootstrap.js"></script>
    <script src="__PUBLIC__/js/layer/layer.js"></script><!--弹窗js 参考文档 http://layer.layui.com/-->
    <script src="__PUBLIC__/js/global.js"></script>
    <script src="__PUBLIC__/js/md5.min.js"></script>
</head>
<body>
<div class="container reg_head">
    <div class="row">
        <div class="col-md-8">
            <a class="m-fnlogoa fn-fl" href="/" >
                <img src="{$tpshop_config['shop_info_store_logo']|default='__PUBLIC__/static/images/logo/pc_home_logo_default.png'}" style="width: 159px;height: 58px;vertical-align: top;"/></a>
            <span class="m-fntit"><h3>登录</h3></span>
        </div>
        <div class="col-md-4">
            <img src="/public/static/images/logo/telephone.png" style="width: 266px;height: 69px;float: right;">
        </div>
    </div>
</div>
<div class="reg_main">
    <div class="col-md-7 reg_word">
        使用场景：汽车4s店营销、饭店开业、辅导班开业、白酒宣传、<br>
        家电促销、婚庆庆典、购物网站宣传、学校招生、企业招商等<br>
        推荐指数：<br>
        推荐理由：营销利器、画面适中、应用最广、性价比高<br>
        产品规格：成品尺寸： A4 16开(210*285mm)；纸张类型：铜版150g；正背颜色：双面彩色印刷<br>
    </div>
    <div class="col-md-5">
        <form class="form-horizontal reg_form" id="loginform" method="post" action="">
            <div class="form-group">
                <h4>账号登录</h4>
            </div>
            <div class="form-group">
                <input type="text" class="form-control J_cellphone"  placeholder="手机号" name="username" id="username" autocomplete="off">
            </div>
            <div class="form-group">
                <input type="password" class="form-control"  placeholder="请输入密码" name="password" autocomplete="off"  id="password" value="">
            </div>
            <div class="form-group">
                <div class="row">
                    <div class="col-sm-7">
                        <input type="text" class="form-control" placeholder="验证码" name="verify_code" id="verify_code" autocomplete="off">
                    </div>
                    <div class="col-sm-5">
                        <img src="/index.php?m=Home&c=User&a=verify" id="verify_code_img" onclick="verify()"/>
                    </div>
                </div>
            </div>

            <div class="row">
               <div class="checkbox col-sm-7">
                    <label>
                        <input type="checkbox" id="checktxt"  checked>
                        <span class="fn-fl">自动登录</span>
                    </label>
                </div>
                <div class="foget_pwt col-sm-5">
                    <a href="{:U('Home/User/forget_pwd')}">忘记密码？</a>
                </div>
            </div>
            <div class="form-group">
                <button type="button" onClick="checkSubmit();" class="btn btn-success btn-block">登录</button>
            </div>
            <!--<div class="form-group tecant_c">
                <ul>
                    <tpshop sql="select * from __PREFIX__plugin where type='login' AND status = 1" item="v" key="k">
                        <if condition="$v['code'] eq 'weixin'">
                            <li class="spacer"></li>
                            <li>
                                <a class="justclix" href="{:U('LoginApi/login',array('oauth'=>'weixin'))}" title="weixin">
                                    <i class="judgp co_wechat"></i>
                                    <span>微信</span>
                                </a>
                            </li>
                        </if>
                        <if condition="$v['code'] eq 'qq'">
                            <li class="spacer"></li>
                            <li>
                                <a class="justclix" href="{:U('LoginApi/login',array('oauth'=>'qq'))}" title="QQ">
                                    <i class="judgp co_qq"></i>
                                    <span>QQ</span>
                                </a>
                            </li>
                        </if>
                        <if condition="$v['code'] eq 'alipay'">
                            <li>
                                <a class="justclix" href="{:U('LoginApi/login',array('oauth'=>'alipay'))}" title="支付宝">
                                    <i class="judgp co_alipay"></i>
                                    <span>支付宝</span>
                                </a>
                            </li>
                        </if>
                    </tpshop>
                </ul>
            </div>-->
            <div class="form-group">
                <p>还没有账号 &nbsp;&nbsp;<a href="{:U('Home/User/reg')}">点击注册</a></p>
            </div>
        </form>
    </div>
</div>
<!--footer-s-->
<div class="footer p">
    <include file="public/login_footer" />
</div>
<!--footer-e-->
<script>
    $(function(){
        $('.text_cmu').focus(function(){
            //焦点获取
            $(this).parents('.text_uspa').addClass('text_uspa_focus');
        })
        $('.text_cmu').blur(function(){
            //失去焦点
            $(this).parents('.text_uspa').removeClass('text_uspa_focus');
        })
    })

    function checkSubmit()
    {
        var username = $.trim($('#username').val());
        var password = $.trim($('#password').val());
        var referurl = $('#referurl').val();
        var verify_code = $.trim($('#verify_code').val());
        if(username == ''){
            showErrorMsg('用户名不能为空!');
            return false;
        }
        if(!checkMobile(username) && !checkEmail(username)){
            showErrorMsg('账号格式不匹配!');
            return false;
        }
        if(password == ''){
            showErrorMsg('密码不能为空!');
            return false;
        }
        if(verify_code == ''){
            showErrorMsg('验证码不能为空!');
            return false;
        }
        $.ajax({
            type : 'post',
            url : '/index.php?m=Home&c=User&a=do_login&t='+Math.random(),
            data : $('#loginform').serialize(),
            dataType : 'json',
            success : function(res){
                if(res.status == 1){
                    window.location.href = res.url;
                }else{
                    showErrorMsg(res.msg);
                    verify();
                }
            },
            error : function(XMLHttpRequest, textStatus, errorThrown) {
                showErrorMsg('网络失败，请刷新页面后重试');
            }
        })

    }

    function checkMobile(tel) {
//        var reg = /(^1[3|4|5|7|8][0-9]{9}$)/;
        var reg = /^1[0-9]{10}$/;
        if (reg.test(tel)) {
            return true;
        }else{
            return false;
        };
    }

    function checkEmail(str){
        var reg = /^([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\-|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
        if(reg.test(str)){
            return true;
        }else{
            return false;
        }
    }

    function showErrorMsg(msg){
        layer.alert(msg, {icon: 2});
//        $('.msg-err').show();
//        $('.J-errorMsg').html(msg);
    }

    function verify(){
        $('#verify_code_img').attr('src','/index.php?m=Home&c=User&a=verify&r='+Math.random());
    }

    //回车提交
    $(document).keyup(function(event){
        if(event.keyCode ==13){
            var isFocus=$("#verify_code").is(":focus");
            if(true==isFocus){
                checkSubmit();
            }
        }
    });
</script>
</body>
</html>
